<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ad Astra · Ozon Physics Studio</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="icon" href="data:," />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Space+Grotesk:wght@500;700&display=swap"
    rel="stylesheet"
  />
</head>
<body>
  <div id="app" class="app-shell">
    <aside class="sidebar">
      <div class="brand">
        <span class="logo">AA</span>
        <div>
          <p class="brand-title">Ad Astra Lab</p>
          <p class="brand-subtitle">Ozon Physics Studio</p>
        </div>
      </div>
      <nav class="nav">
        <button class="nav-item" :class="{ active: activeTab === 'sim' }" @click="activeTab = 'sim'">
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24"><path d="M4 4h16v5H4zM4 13h7v7H4zM13 13h7v7h-7z" /></svg>
          </span>
          Симуляция
        </button>
        <button class="nav-item" :class="{ active: activeTab === 'modules' }" @click="activeTab = 'modules'">
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24"><path d="M4 7h16M4 12h16M4 17h10" /></svg>
          </span>
          Редактор модулей
        </button>
        <button class="nav-item" :class="{ active: activeTab === 'control' }" @click="activeTab = 'control'">
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24"><path d="M12 4v16M4 12h16" /></svg>
          </span>
          Матрицы контроля
        </button>
        <button class="nav-item" :class="{ active: activeTab === 'export' }" @click="activeTab = 'export'">
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24"><path d="M12 3v12m0 0l4-4m-4 4l-4-4M4 21h16" /></svg>
          </span>
          Экспорт модели
        </button>
      </nav>
      <div class="sidebar-card">
        <h4>Состояние станции</h4>
        <div class="status-line">
          <span>Контуры</span>
          <strong>{{ status.loops }}</strong>
        </div>
        <div class="status-line">
          <span>Риск</span>
          <strong>{{ status.risk }}</strong>
        </div>
        <div class="status-line">
          <span>Сценарий</span>
          <strong>{{ scenarioLabel }}</strong>
        </div>
      </div>
      <div class="sidebar-card">
        <h4>Драйверы физики</h4>
        <div class="pill-grid">
          <span class="pill">Кинетика</span>
          <span class="pill">Гидравлика</span>
          <span class="pill">Массообмен</span>
          <span class="pill">ОРП/UV</span>
        </div>
      </div>
      <div class="sidebar-footer">
        <p>Редактор цифрового двойника: озонная очистка воды</p>
      </div>
    </aside>

    <main class="content">
      <header class="hero">
        <div>
          <p class="eyebrow">управление · физика · оптимизация</p>
          <h1>Непрерывная озонная очистка воды</h1>
          <p class="lead">
            Инженерный интерфейс уровня лабораторного стенда: настраиваемые модули, физические
            зависимости и контрольные контуры. Меняйте параметры и наблюдайте динамику модели.
          </p>
        </div>
        <div class="kpi-stack">
          <div class="kpi-card">
            <span>Качество воды</span>
            <strong>{{ metrics.quality.toFixed(1) }}%</strong>
            <small>{{ metrics.qualityNote }}</small>
          </div>
          <div class="kpi-card">
            <span>Residual O3</span>
            <strong>{{ metrics.residual.toFixed(2) }} мг/л</strong>
            <small>{{ metrics.residualNote }}</small>
          </div>
          <div class="kpi-card">
            <span>Энергия</span>
            <strong>{{ metrics.energy.toFixed(2) }} кВт·ч/м³</strong>
            <small>{{ metrics.energyNote }}</small>
          </div>
        </div>
      </header>

      <section class="studio-grid">
        <div class="panel workspace">
          <div class="panel-header">
            <div>
              <h2>Редактор модулей</h2>
              <p class="panel-subtitle">Соберите технологическую линию из операторов процесса.</p>
            </div>
            <div class="actions">
              <button class="primary" @click="toggleSimulation">
                <span class="icon">
                  <svg viewBox="0 0 24 24"><path :d="running ? 'M6 4h4v16H6zM14 4h4v16h-4z' : 'M6 4l12 8-12 8z'" /></svg>
                </span>
                {{ running ? 'Пауза' : 'Старт' }}
              </button>
              <button class="ghost" @click="resetSimulation">
                <span class="icon"><svg viewBox="0 0 24 24"><path d="M4 12a8 8 0 101.8-5M4 4v5h5" /></svg></span>
                Сброс
              </button>
            </div>
          </div>

          <div class="module-canvas">
            <div class="module" v-for="module in modules" :key="module.id">
              <div class="module-header">
                <div>
                  <h3>{{ module.name }}</h3>
                  <span class="module-type">{{ module.type }}</span>
                </div>
                <button class="icon-button" @click="removeModule(module.id)" aria-label="Удалить модуль">
                  <svg viewBox="0 0 24 24"><path d="M6 7h12M9 7V5h6v2m-7 0v12m4-12v12m4-12v12" /></svg>
                </button>
              </div>
              <div class="module-body">
                <div class="module-metric">
                  <span>Эффективность</span>
                  <strong>{{ module.efficiency.toFixed(2) }}</strong>
                </div>
                <div class="module-metric">
                  <span>Потери</span>
                  <strong>{{ module.loss.toFixed(2) }}</strong>
                </div>
                <div class="module-metric">
                  <span>Скорость</span>
                  <strong>{{ module.rate.toFixed(1) }}</strong>
                </div>
              </div>
            </div>
            <div class="module add-module">
              <h3>Добавить модуль</h3>
              <label>
                Название
                <input v-model="newModule.name" placeholder="Напр. фильтр" />
              </label>
              <label>
                Тип
                <select v-model="newModule.type">
                  <option>Смешивание</option>
                  <option>Дозирование O3</option>
                  <option>Контакт</option>
                  <option>Дегазация</option>
                  <option>Разделение</option>
                  <option>Фильтрация</option>
                </select>
              </label>
              <button class="primary" @click="addModule">Добавить</button>
            </div>
          </div>

          <div class="control-grid">
            <label>
              Расход воды Qw (м³/ч)
              <input type="range" min="20" max="150" step="1" v-model.number="inputs.flow" />
              <span class="value">{{ inputs.flow }}</span>
            </label>
            <label>
              Концентрация загрязнений Cin (мг/л)
              <input type="range" min="5" max="90" step="1" v-model.number="inputs.contamination" />
              <span class="value">{{ inputs.contamination }}</span>
            </label>
            <label>
              Подача озона QO3 (г/ч)
              <input type="range" min="40" max="280" step="1" v-model.number="inputs.ozone" />
              <span class="value">{{ inputs.ozone }}</span>
            </label>
            <label>
              Время контакта τ (мин)
              <input type="range" min="4" max="40" step="1" v-model.number="inputs.contact" />
              <span class="value">{{ inputs.contact }}</span>
            </label>
            <label>
              Температура (°C)
              <input type="range" min="4" max="36" step="1" v-model.number="inputs.temp" />
              <span class="value">{{ inputs.temp }}</span>
            </label>
            <label>
              pH
              <input type="range" min="5.4" max="9.2" step="0.1" v-model.number="inputs.ph" />
              <span class="value">{{ inputs.ph.toFixed(1) }}</span>
            </label>
          </div>
        </div>

        <div class="panel analytics">
          <div class="panel-header">
            <div>
              <h2>Физические тренды</h2>
              <p class="panel-subtitle">Динамика качества, residual O3, энергии и нагрузки.</p>
            </div>
            <select v-model="selectedScenario" @change="applyScenario">
              <option value="nominal">Номинал</option>
              <option value="peak">Пиковые загрязнения</option>
              <option value="cold">Холодный режим</option>
              <option value="shock">Гидроудар</option>
            </select>
          </div>
          <div class="chart-stack">
            <canvas id="trendChart"></canvas>
            <canvas id="stateChart"></canvas>
          </div>
          <div class="legend-row">
            <span class="legend quality">Качество</span>
            <span class="legend residual">Residual O3</span>
            <span class="legend energy">Энергия</span>
            <span class="legend load">Нагрузка</span>
            <span class="legend orp">ORP</span>
            <span class="legend uv">UV254</span>
          </div>
        </div>

        <div class="panel inspector">
          <div class="panel-header">
            <div>
              <h2>Инспектор системы</h2>
              <p class="panel-subtitle">Контуры, ограничения и аналитика.</p>
            </div>
            <span class="pill" :class="{ danger: metrics.residual > 0.5 }">
              {{ metrics.residual > 0.5 ? 'LIMIT' : 'SAFE' }}
            </span>
          </div>
          <div class="inspector-grid">
            <div class="inspector-card">
              <h3>Контуры управления</h3>
              <ul>
                <li>Feedforward: {{ control.feedforward.toFixed(1) }}</li>
                <li>Feedback Q: {{ control.feedbackQuality.toFixed(1) }}</li>
                <li>Feedback O3: {{ control.feedbackResidual.toFixed(1) }}</li>
                <li>QO3 уставка: {{ control.ozone.toFixed(1) }}</li>
                <li>τ уставка: {{ control.contact.toFixed(1) }}</li>
              </ul>
            </div>
            <div class="inspector-card">
              <h3>Сенсоры</h3>
              <ul>
                <li>ORP: {{ metrics.orp.toFixed(0) }} мВ</li>
                <li>UV254: {{ metrics.uv.toFixed(2) }}</li>
                <li>Температура: {{ metrics.temp.toFixed(1) }} °C</li>
                <li>pH: {{ metrics.ph.toFixed(2) }}</li>
              </ul>
            </div>
            <div class="inspector-card">
              <h3>Журнал событий</h3>
              <ul>
                <li v-for="event in events" :key="event.id">{{ event.message }}</li>
              </ul>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="script.js"></script>
</body>
</html>
